<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Test API</title>
</head>

<body>
    <button id="btnLogin">Login</button>
    <button id="btnGetCentral">Get Central List</button>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        var host = "https://devapi.cfibilling.com";
        var cred = {
            "cc": "P2",
            "user": "API$APAY",
            "password": "D2054E5E542A4C4FA948A01266"
        };

        // Save token to localStorage
        function saveToken(token) {
            localStorage.setItem('tokenAPI', token);
        }

        // Get token from localStorage
        function getToken() {
            return localStorage.getItem('tokenAPI');
        }

        async function login() {
            try {
                const fetchResult = await fetch(host + "/login", {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                        "Accept-Encoding": "*",
                    },
                    body: JSON.stringify(cred)
                });
                const returnResponse = await fetchResult.json();

                if (fetchResult.ok) {
                    var token = returnResponse.login_response.token;

                    console.log("API Endpoint: login");
                    console.log("token: " + token);
                    console.log({ returnResponse });

                    // Save token to localStorage
                    saveToken(token);
                } else {
                    console.log("Error: " + returnResponse.message);
                }
            } catch (error) {
                console.log("An error occurred during login:", error);
            }
        }

        async function dbCentralList(payload) {
            try {
                console.log({ toke: getToken() })
                const fetchResult = await fetch(host + "/dbCentralList", {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                        "Accept-Encoding": "*",

                    },
                    body: JSON.stringify(payload)
                });
                const returnResponse = await fetchResult.json();

                if (fetchResult.ok) {
                    console.log("API Endpoint: dbCentralList");
                    console.log(returnResponse.dbCentralList_response);
                } else {
                    console.log("Error: " + returnResponse.message);
                }
            } catch (error) {
                console.log("An error occurred while fetching the central list:", error);
            }
        }

        $(document).ready(function () {
            $("#btnLogin").click(async function (e) {
                await login();
            });

            $("#btnGetCentral").click(async function (e) {
                await dbCentralList({});
            });
        });
    </script>
</body>

</html>
